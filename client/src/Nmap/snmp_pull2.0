#!/bin/bash
getIp (){
  ip="$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1')"
  subnet="$(ifconfig | grep -Eo 'netmask (addr:)?([0-255]*\.){3}[0-255]*' | grep -Eo '([0-9]*\.){3}[0-255]*' | grep -v '255.0.0.0')"
  declare -a array=()

  firstOc=`echo $ip | cut -d . -f 1`
  secondOc=`echo $ip | cut -d . -f 2`
  thirdOc=`echo $ip | cut -d . -f 3`
  fourthOc=`echo $ip | cut -d . -f 4`

  firstOcSub=`echo $subnet | cut -d . -f 1`
  secondOcSub=`echo $subnet | cut -d . -f 2`
  thirdOcSub=`echo $subnet | cut -d . -f 3`
  fourthOcSub=`echo $subnet | cut -d . -f 4`

  Array+=($firstOc $secondOc $thirdOc $fourthOc $firstOcSub $secondOcSub $thirdOcSub $fourthOcSub)

}

first_subnet () {

  subnet = ${Array[4]}.${Array[5]}.${Array[6]}.${Array[7]}
  if [ ${Array[7]} = 128 ]
    then
      net=126
    else
      echo "cant fint subnet size"
  fi
  if [ ${Array[7]} = 0 ]
    then
      net=254
    else
      echo "cant fint subnet size"
  fi
  # ping -c2 ${Array[0]}.${Array[1]}.${Array[2]}.${Array[3]}

  for i in $(seq 1 $net);
  do ping -c1 ${Array[0]}.${Array[1]}.${Array[2]}.$i
    if [ $? -eq 0 ]
      then
        snmpwalk -v 2c -csv -c secretstring 192.168.1.$i iso.3.6.1.4.1.9.2.1.3 >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
        snmpwalk -v 2c -csv -c secretstring 192.168.1.$i iso.3.6.1.2.1.1.1.0 >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
        echo ip 192.168.1.$i >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
      else
        echo "ip not found"
    fi
  done;
}

getIp
first_subnet
# python ./converter.py
