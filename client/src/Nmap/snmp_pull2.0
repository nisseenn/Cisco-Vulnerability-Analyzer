#!/bin/bash
getIp (){
  ip="$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1')"
  subnet="$(ifconfig | grep -Eo 'netmask (addr:)?([0-255]*\.){3}[0-255]*' | grep -Eo '([0-9]*\.){3}[0-255]*' | grep -v '255.0.0.0')"
  declare -a array=()

  firstOc=`echo $ip | cut -d . -f 1`
  secondOc=`echo $ip | cut -d . -f 2`
  thirdOc=`echo $ip | cut -d . -f 3`
  fourthOc=`echo $ip | cut -d . -f 4`

  firstOcSub=`echo $subnet | cut -d . -f 1`
  secondOcSub=`echo $subnet | cut -d . -f 2`
  thirdOcSub=`echo $subnet | cut -d . -f 3`
  fourthOcSub=`echo $subnet | cut -d . -f 4`

  Array+=($firstOc $secondOc $thirdOc $fourthOc $firstOcSub $secondOcSub $thirdOcSub $fourthOcSub)

}

first_subnet () {

  subnet = ${Array[4]}.${Array[5]}.${Array[6]}.${Array[7]}

  if [ ${Array[6]} = 255 ] && [ ${Array[7]} = 224 ]
    then
      net=30
      echo "you are in the" ${Array[4]}.${Array[5]}.255.224 "subnet"
    else
      echo "checking if you are in the" ${Array[4]}.${Array[5]}.255.224 "subnet"
  fi
  if [ ${Array[6]} = 255 ] && [ ${Array[7]} = 192 ]
    then
      net=62
      echo "you are in the" ${Array[4]}.${Array[5]}.255.192 "subnet"
    else
      echo "checking if you are in the" ${Array[4]}.${Array[5]}.255.192 "subnet"
  fi
  if [ ${Array[6]} = 255 ] && [ ${Array[7]} = 128 ]
    then
      net=126
      echo "you are in the" ${Array[4]}.${Array[5]}.255.128 "subnet"
    else
      echo "checking if you are in the" ${Array[4]}.${Array[5]}.255.128 "subnet"
  fi
  if [ ${Array[6]} = 255 ] && [ ${Array[7]} = 0 ]
    then
      net=254
      echo "you are in the" ${Array[4]}.${Array[5]}.255.0 "subnet"
    else
      echo "checking if you are in the" ${Array[4]}.${Array[5]}.255.0 "subnet"
  fi
  # ping -c2 ${Array[0]}.${Array[1]}.${Array[2]}.${Array[3]}

  for i in $(seq 1 $net);
  do ping -c1 ${Array[0]}.${Array[1]}.${Array[2]}.$i
    if [ $? -eq 0 ]
      then
        snmpwalk -v 2c -csv -c secretstring ${Array[0]}.${Array[1]}.${Array[2]}.$i iso.3.6.1.4.1.9.2.1.3 >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
        snmpwalk -v 2c -csv -c secretstring ${Array[0]}.${Array[1]}.${Array[2]}.$i iso.3.6.1.2.1.1.1.0 >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
        echo ip ${Array[0]}.${Array[1]}.${Array[2]}.$i >> //home/vitorro/Documents/WebDev/cisco/client/src/Nmap/fil.csv
      else
        echo ${Array[0]}.${Array[1]}.${Array[2]}.$i "not found"
    fi
  done;
}

getIp
first_subnet
python ./converter.py
